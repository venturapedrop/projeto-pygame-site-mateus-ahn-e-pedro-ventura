const translations = {
  pt: {
    brandName: "DT",
    navHome: "Início",
    navInstructions: "Instruções",
    navStory: "História",
    heroTitle: "Digitore",
    heroByline: "Devs: Mateus Ahn &amp; Pedro Ventura",
    heroSubtitle:
      "Defenda sua torre digitando as palavras que aparecem nos inimigos que se aproximam! Sobreviva ao ataque enquanto alterna idiomas e aumenta sua velocidade de digitação.",
    ctaPlay: "Jogar Agora",
    ctaDownload: "Baixar Jogo",
    ctaDevlog: "Diário de Desenvolvimento",
    featureLevelsTitle: "10 Níveis",
    featureLevelsText: "Dificuldade Progressiva",
    featureLanguagesTitle: "2 Idiomas",
    featureLanguagesText: "Suporte EN &amp; PT",
    featureBossTitle: "Batalhas contra Chefes",
    featureBossText: "Fases Finais Épicas",
    demoTitle: "Demonstração",
    demoCaption: "Vídeo de gameplay no YouTube.",
    aboutTitle: "Sobre o Jogo",
    aboutLead:
      "Digitore é um jogo de tower defense baseado em digitação, onde o jogador deve defender sua torre digitando as palavras que aparecem nos inimigos que se aproximam. O jogo traz múltiplos níveis com dificuldade crescente, animações, efeitos sonoros e um sistema de pontuação e ranking.",
    infoCard1:
      "<strong>10 Níveis Progressivos</strong>Tipos diferentes de inimigos: letras minúsculas, maiúsculas e palavras completas.",
    infoCard2:
      "<strong>Sistema de Chefes</strong>Níveis 9 e 10 trazem chefes complexos com sequências desafiadoras.",
    infoCard3:
      "<strong>Suporte Bilíngue</strong>Jogue em Português ou Inglês com tradução adaptada.",
    infoCard4:
      "<strong>Fundos Dinâmicos</strong>Os cenários mudam conforme o progresso em cada nível.",
    infoCard5:
      "<strong>Animações de Sprites</strong>Sprites animados dão vida a personagens, explosões e efeitos.",
    infoCard6:
      "<strong>Pontuação &amp; Ranking</strong>Ranking completo salva em JSON para acompanhar seus recordes.",
    howToTitle: "Como Jogar",
    howToMainTitle: "Menu Principal",
    howToMainList:
      "<li>S &mdash; Iniciar jogo</li><li>Q &mdash; Sair</li><li>L &mdash; Alternar idioma (Português/Inglês)</li>",
    howToGameTitle: "Durante o Jogo",
    howToGameList:
      "<li>Digite as letras/palavras que aparecem nos inimigos</li><li>Mantenha a precisão para liberar bônus explosivos</li><li>ESC &mdash; Pausar jogo</li>",
    howToPauseTitle: "Menu de Pausa",
    howToPauseList:
      "<li>ESC &mdash; Retomar jogo</li><li>M &mdash; Voltar ao menu principal</li>",
    howToScoreTitle: "Telas de Pontuação",
    howToScoreList:
      "<li>R &mdash; Reiniciar jogo</li><li>M &mdash; Menu principal</li><li>Enter &mdash; Confirmar entrada de nome</li>",
    techTitle: "Recursos Técnicos",
    techFeaturesTitle: "Características",
    techFeaturesList:
      "<li>Arquitetura orientada a objetos com classes e responsabilidades separadas</li><li>Herança de pygame.sprite para detecção de colisão</li><li>Arquitetura baseada em telas para cada estado do jogo</li><li>Documentação completa com docstrings em classes e métodos</li><li>Código organizado em múltiplos arquivos para melhor manutenibilidade</li>",
    techRequirementsTitle: "Requisitos",
    techRequirementsList:
      "<li>Python 3.7 ou superior</li><li>Biblioteca Pygame</li>",
    techInstallTitle: "Instalação",
    techInstallList:
      "<li>Clone ou baixe o repositório</li><li>Instale o Pygame: <code>pip install pygame</code></li><li>Execute: <code>python3 game.py</code></li>",
    development:
      "Este projeto nasceu como uma experiência de aprendizado em Python/Pygame, combinando mecânicas de tower defense com desafios de digitação. Evoluímos de um protótipo simples para uma aventura com 10 níveis, batalhas contra chefes e um sistema completo de pontuação.<br /><br />Criado por Mateus Ahn &amp; Pedro Ventura",
    galleryTitle: "Capturas de Tela",
    devlogTitle: "Registro de Desenvolvimento",
    footerBrand: "Digitore",
    footerDemo: "Demonstração",
    footerInstructions: "Instruções",
    footerDownload: "Baixar Jogo",
    footerCopy:
      "&copy; Criado por Mateus Ahn &amp; Pedro Ventura. Todos os direitos reservados."
  },
  en: {
    brandName: "ToT",
    navHome: "Home",
    navInstructions: "Instructions",
    navStory: "Storyline",
    heroTitle: "Tower of Typing",
    heroByline: "Devs: Mateus Ahn &amp; Pedro Ventura",
    heroSubtitle:
      "Defend your tower by typing the words that appear on approaching enemies. Swap languages, build speed, and survive the retro gauntlet.",
    ctaPlay: "Play the Game",
    ctaDownload: "Download Game",
    ctaDevlog: "Development Log",
    featureLevelsTitle: "10 Levels",
    featureLevelsText: "Progressive Difficulty",
    featureLanguagesTitle: "2 Languages",
    featureLanguagesText: "EN &amp; PT Support",
    featureBossTitle: "Boss Battles",
    featureBossText: "Epic Final Levels",
    demoTitle: "Game Demo",
    demoCaption: "Gameplay demo on YouTube.",
    aboutTitle: "About the Game",
    aboutLead:
      "Tower of Typing is a tower-defense typing experience. Stop the oncoming horde by shredding through their words, master ten handcrafted levels, and climb the scoring ladder.",
    infoCard1:
      "<strong>10 Progressive Levels</strong>Different enemy types: lowercase letters, uppercase letters, and complete words.",
    infoCard2:
      "<strong>Boss System</strong>Levels nine and ten unleash complex boss encounters packed with tricky sequences.",
    infoCard3:
      "<strong>Dual Language Support</strong>Play in Portuguese or English with adapted translations.",
    infoCard4:
      "<strong>Dynamic Backgrounds</strong>Visuals evolve as you advance, keeping the atmosphere fresh.",
    infoCard5:
      "<strong>Sprite Animations</strong>Animated sprites bring characters, explosions, and effects to life.",
    infoCard6:
      "<strong>Scoring &amp; Ranking</strong>Post-game rankings save to JSON so you can chase high scores.",
    howToTitle: "How to Play",
    howToMainTitle: "Main Menu",
    howToMainList:
      "<li>S &mdash; Start game</li><li>Q &mdash; Quit</li><li>L &mdash; Switch language (PT / EN)</li>",
    howToGameTitle: "During the Game",
    howToGameList:
      "<li>Type the letters or words floating toward the tower</li><li>Maintain accuracy to trigger explosive bonuses</li><li>ESC &mdash; Pause game</li>",
    howToPauseTitle: "Pause Menu",
    howToPauseList:
      "<li>ESC &mdash; Resume game</li><li>M &mdash; Return to main menu</li>",
    howToScoreTitle: "Score Screens",
    howToScoreList:
      "<li>R &mdash; Restart game</li><li>M &mdash; Back to the main menu</li><li>Enter &mdash; Confirm name entry</li>",
    howToNull: "",
    techTitle: "Technical Features",
    techFeaturesTitle: "Features",
    techFeaturesList:
      "<li>Object-oriented architecture with clear responsibilities</li><li>Pygame sprite inheritance for collision detection</li><li>Screen-based structure for each game state</li><li>Extensive docstrings on classes and methods</li><li>Organized multi-file codebase for maintainability</li>",
    techRequirementsTitle: "Requirements",
    techRequirementsList:
      "<li>Python 3.7 or newer</li><li>Pygame library</li>",
    techInstallTitle: "Installation",
    techInstallList:
      "<li>Clone or download the repository</li><li>Install Pygame: <code>pip install pygame</code></li><li>Run <code>python3 game.py</code></li>",
    development:
      "This project started as a Python/Pygame learning journey, combining tower defense mechanics with typing challenges. It evolved into a full adventure with ten handcrafted levels, boss battles, and a complete scoring system.<br /><br />Created by Mateus Ahn &amp; Pedro Ventura",
    galleryTitle: "Screenshots",
    devlogTitle: "Development Log",
    footerBrand: "Tower of Typing",
    footerDemo: "Game Demo",
    footerInstructions: "Instructions",
    footerDownload: "Download Game",
    footerCopy:
      "&copy; Created by Mateus Ahn &amp; Pedro Ventura. All rights reserved."
  }
};

const elements = document.querySelectorAll("[data-i18n]");
const langToggle = document.querySelector("[data-lang-toggle]");
let currentLang = "en";

function applyTranslations(lang) {
  const dictionary = translations[lang];
  if (!dictionary) {
    return;
  }

  // Replace the inner HTML for every annotated node with the selected language snippet.
  elements.forEach((el) => {
    const key = el.dataset.i18n;
    const translation = dictionary[key];
    if (translation !== undefined) {
      el.innerHTML = translation;
    }
  });

  document.documentElement.lang = lang;

  if (langToggle) {
    if (lang === "pt") {
      langToggle.setAttribute("aria-label", "Alternar idioma para inglês");
    } else {
      langToggle.setAttribute("aria-label", "Switch language to Portuguese");
    }
  }

  currentLang = lang;
}

if (langToggle) {
  langToggle.addEventListener("click", () => {
    const nextLang = currentLang === "pt" ? "en" : "pt";
    applyTranslations(nextLang);
  });
}

applyTranslations(currentLang);

// --- Simple Lightbox for the gallery ---
(function setupGalleryLightbox() {
  const items = Array.from(document.querySelectorAll(".gallery__item"));
  if (!items.length) return;

  const lightbox = document.querySelector("[data-lightbox]");
  const img = lightbox?.querySelector(".lightbox__image");
  const caption = lightbox?.querySelector(".lightbox__caption");
  const btnClose = lightbox?.querySelector("[data-lightbox-close]");
  const btnPrev = lightbox?.querySelector("[data-lightbox-prev]");
  const btnNext = lightbox?.querySelector("[data-lightbox-next]");

  let current = 0;

  function show(index) {
    current = (index + items.length) % items.length;
    const el = items[current];
    const src = el.getAttribute("data-full") || el.querySelector("img")?.src;
    const text = el.getAttribute("data-caption") || "";
    if (img) img.src = src;
    if (caption) caption.textContent = text;
  }

  function open(index) {
    if (!lightbox) return;
    show(index);
    lightbox.hidden = false;
    document.body.style.overflow = "hidden";
  }

  function close() {
    if (!lightbox) return;
    lightbox.hidden = true;
    document.body.style.overflow = "";
  }

  items.forEach((btn, idx) => {
    btn.addEventListener("click", () => open(idx));
  });

  btnClose?.addEventListener("click", close);
  btnPrev?.addEventListener("click", () => show(current - 1));
  btnNext?.addEventListener("click", () => show(current + 1));

  // Close when clicking backdrop (but not on figure or nav)
  lightbox?.addEventListener("click", (e) => {
    if (!(e.target instanceof Element)) return;
    const target = e.target;
    const clickedBackdrop = target.matches("[data-lightbox]");
    if (clickedBackdrop) close();
  });

  // Keyboard controls
  window.addEventListener("keydown", (e) => {
    if (lightbox?.hidden) return;
    if (e.key === "Escape") close();
    if (e.key === "ArrowLeft") show(current - 1);
    if (e.key === "ArrowRight") show(current + 1);
  });
})();

// --- Development Log Modal ---
(function setupDevlogModal() {
  const openBtn = document.querySelector("[data-devlog-open]");
  const modal = document.querySelector("[data-devlog-modal]");
  const closeBtn = document.querySelector("[data-devlog-close]");
  const timeline = document.querySelector("[data-devlog-timeline]");

  if (!openBtn || !modal || !timeline) return;

  // Commit data extracted from the provided log
  const commits = [
    { hash: "0fc25e3", date: "2025-10-22", message: "organized game object aspects", author: "matahn" },
    { hash: "117f923", date: "2025-10-22", message: "Final Version Complete", author: "matahn", coauthor: "Pedro Ventura" },
    { hash: "6511a49", date: "2025-10-22", message: "final version", author: "matahn", coauthor: "Pedro Ventura" },
    { hash: "8e1509f", date: "2025-10-21", message: "slight code changes. testing version", author: "matahn" },
    { hash: "6c9382f", date: "2025-10-21", message: "functional game", author: "matahn" },
    { hash: "db706f5", date: "2025-10-21", message: "Fixed enemy_config", author: "Pedro Ventura" },
    { hash: "1ef9e1e", date: "2025-10-21", message: "minor changes to resolution after scale change", author: "matahn" },
    { hash: "af5c96c", date: "2025-10-21", message: "teste scale", author: "matahn" },
    { hash: "1fb28bc", date: "2025-10-21", message: "testing boss", author: "matahn" },
    { hash: "206bd81", date: "2025-10-21", message: "minor changes", author: "matahn" },
    { hash: "7da5936", date: "2025-10-21", message: "finalizacao do codigo e elaboracao do arquivo read me. aderindo a rubricas", author: "matahn", coauthor: "Pedro Ventura" },
    { hash: "7f9b852", date: "2025-10-21", message: "changed font color to white", author: "matahn" },
    { hash: "70088dc", date: "2025-10-20", message: "hidden ending", author: "matahn" },
    { hash: "65f3dd7", date: "2025-10-20", message: "testing final message", author: "matahn" },
    { hash: "5939eac", date: "2025-10-20", message: "text color change and minor bug fixes.", author: "matahn" },
    { hash: "a2fa086", date: "2025-10-20", message: "font color change", author: "matahn" },
    { hash: "8044e13", date: "2025-10-20", message: "second boss position corrected", author: "matahn" },
    { hash: "43a748c", date: "2025-10-20", message: "boss text easier", author: "matahn" },
    { hash: "83fb9f5", date: "2025-10-20", message: "removed acentos from portuguese words in boss", author: "matahn" },
    { hash: "52c03c8", date: "2025-10-20", message: "implementado funcionalidades de background e edicao de codigo", author: "matahn" },
    { hash: "0ea8297", date: "2025-10-20", message: "Added background files", author: "Pedro Ventura" },
    { hash: "fb3f822", date: "2025-10-20", message: "tentativa de correcao (nao consigo ver o boss) hitbox de box", author: "matahn" },
    { hash: "1ae67bd", date: "2025-10-20", message: "boss text translation added", author: "matahn" },
    { hash: "11a2bf7", date: "2025-10-19", message: "Fixed boss hitbox", author: "Pedro Ventura" },
    { hash: "a3c815b", date: "2025-10-17", message: "reverted to full screen", author: "matahn" },
    { hash: "e5c1cf3", date: "2025-10-17", message: "translation complete. testing window size", author: "matahn" },
    { hash: "4ef75b7", date: "2025-10-17", message: "Changed fonts, sounds & layouts", author: "Pedro Ventura" },
    { hash: "54fcb20", date: "2025-10-17", message: "boss sprites added", author: "matahn" },
    { hash: "22535ad", date: "2025-10-17", message: "Background, explosion, and level up sounds", author: "Pedro Ventura" },
    { hash: "7007049", date: "2025-10-16", message: "recovered version", author: "matahn" },
    { hash: "8ecbe09", date: "2025-10-16", message: "Rearranged file structure", author: "Pedro Ventura" },
    { hash: "f82a349", date: "2025-10-16", message: "colocado no git correto", author: "matahn" },
    { hash: "ea39d37", date: "2025-10-14", message: "add deadline", author: "github-classroom[bot]" },
    { hash: "029443a", date: "2025-08-25", message: "Initial commit", author: "github-classroom[bot]" }
  ];

  function populateTimeline() {
    timeline.innerHTML = commits.map(commit => `
      <div class="devlog-commit">
        <div class="devlog-commit__date">
          <span class="devlog-commit__hash">${commit.hash}</span>
          ${commit.date}
        </div>
        <div class="devlog-commit__message">${commit.message}</div>
        <div class="devlog-commit__author">by ${commit.author}</div>
        ${commit.coauthor ? `<div class="devlog-commit__coauthor">Co-authored-by: ${commit.coauthor}</div>` : ''}
      </div>
    `).join('');
  }

  function openModal() {
    populateTimeline();
    modal.hidden = false;
    document.body.style.overflow = "hidden";
  }

  function closeModal() {
    modal.hidden = true;
    document.body.style.overflow = "";
  }

  openBtn.addEventListener("click", openModal);
  closeBtn?.addEventListener("click", closeModal);

  // Close on backdrop click
  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
  });

  // Close on Escape key
  window.addEventListener("keydown", (e) => {
    if (!modal.hidden && e.key === "Escape") closeModal();
  });
})();
